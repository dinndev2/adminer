<aside class="hidden lg:flex lg:w-64 lg:flex-col lg:border-r lg:border-gray-200 lg:bg-white">
  <div class="flex h-16 items-center px-6 border-b border-gray-100">
    <div class="flex items-center gap-2">
      <% if current_user.tenant.logo.attached? %>
        <%= render partial: "shared/profile_lg", locals: {path: url_for(current_user.tenant.logo)} %>
      <% else %>
        <div class="h-9 w-9 rounded-xl bg-gray-900"></div>
      <% end %>
      <div>
        <p class="text-sm font-semibold text-gray-900"><%= current_user.tenant.name %></p>
        <p class="text-xs text-gray-500">Workspace</p>
      </div>
    </div>
  </div>

  <nav class="flex-1 px-4 py-6 space-y-6">
    <% active = nav_active?(dashboard_item) %>
    <%= link_to root_path, class: nav_item_classes(active) do %>
      <%= inline_svg_tag "home.svg", class: nav_icon_classes(active) %>
      Home
    <% end %>
    <div class="space-y-1">
      <p class="px-2 text-[11px] font-semibold tracking-wider text-gray-400 uppercase">Businesses</p>
      <% @businesses.each do |business| %>
        <% business_items = nav_items(business) %>
        <% business_active = business_items.any? { |item| nav_active?(item) } %>
        <div data-controller="collapse" class="space-y-2">
          <div class="flex items-center justify-between rounded-md px-2.5 py-1.5 hover:bg-gray-50">
            <%= link_to business_bookings_path(business),
              class: "text-xs font-semibold text-gray-700 truncate flex-1 block -my-1.5 py-1.5 -ml-2.5 pl-2.5" do %>
              <%= business.name %>
            <% end %>
            <button
              type="button"
              data-action="click->collapse#toggle"
              data-collapse-target="toggle"
              class="ml-2 inline-flex h-6 w-6 items-center justify-center rounded-md text-gray-500 hover:bg-gray-100 hover:text-gray-700"
              aria-expanded="<%= business_active %>"
              aria-label="Toggle business links"
            >
              <%= inline_svg_tag "cheveron-right.svg", class: "h-3 w-3 transition-transform #{'rotate-90' if business_active}", data: { collapse_target: "icon" } %>
            </button>
          </div>
          <div
            data-collapse-target="content"
            class="space-y-1.5 pl-2 overflow-hidden transition-[max-height,opacity] duration-200 ease-out <%= business_active ? 'max-h-64 opacity-100' : 'max-h-0 opacity-0' %>"
          >
            <% business_items.each do |item| %>
              <% active = nav_active?(item) %>
              <%= link_to item.path, class: nav_item_classes(active) do %>
                <%= inline_svg_tag "#{item.icon}.svg", class: nav_icon_classes(active) %>
                <span class="truncate"><%= item.label %></span>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
      <div data-controller="form" class="space-y-2">
        <% if @tenant.supercharged? %>  
          <button
            type="button"
            data-action="form#toggleVisibility"
            class="w-full cursor-pointer inline-flex items-center justify-center gap-2 rounded-md border border-gray-200 bg-white px-2.5 py-2 text-xs font-semibold text-gray-700 hover:bg-gray-50"
          >
            <%= inline_svg_tag "s-plus.svg", class: "h-4 w-4" %>
            Add business
          </button>
        <% else %>
          <%= link_to subscription_path,
            data: { controller: "modal", turbo_frame: "modal-content" },
            class: "w-full cursor-pointer inline-flex items-center justify-center gap-2 rounded-md border border-gray-200 bg-white px-2.5 py-2 text-xs font-semibold text-gray-700 hover:bg-gray-50" do %>
            <%= inline_svg_tag "s-plus.svg", class: "h-4 w-4" %>
            Add business
          <% end %>
        <% end %>

        <%= form_with model: Business.new, class: "invisible-form", data: { form_target: "toggleable" } do |f| %>
          <div class="flex gap-2 w-full">
            <%= f.hidden_field :tenant_id, value: @tenant.id  %>
            <%= f.text_field :name, class: "font-semibold rounded-md border flex-1 border-gray-200 focus:outline-none px-2.5 py-2 text-gray-800 text-xs bg-gray-50", placeholder: "Add your new business name" %>
            <button class="rounded-md cursor-pointer bg-gray-900 px-2 text-white hover:bg-gray-800" type="submit">
              <%= inline_svg_tag "s-plus.svg", class: "h-4 w-4" %>
            </button>
          </div>
        <% end %>
      </div>
    </div>

    <div>
      <p class="px-3 text-[11px] font-semibold tracking-wider text-gray-400 uppercase">Account</p>
      <div class="mt-3 space-y-1.5">
        <% settings_items.each do |item| %>
          <% active = nav_active?(item) %>
          <%= link_to item.path, class: nav_item_classes(active) do %>
            <%= inline_svg_tag "#{item.icon}.svg", class: nav_icon_classes(active) %>
            <span class="truncate"><%= item.label %></span>
          <% end %>
        <% end %>

        <%= button_to destroy_user_session_path, method: :delete,
          class: "group w-full flex items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 transition" do %>
          <%= inline_svg_tag "logout.svg", class: "h-5 w-5 text-gray-400 group-hover:text-gray-600" %>
          <span>Sign out</span>
        <% end %>
      </div>
    </div>
  </nav>
</aside>
